<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Phone SMS Remote Panel</title>
<style>
body{font-family:Arial;padding:20px;background:#f0f2f4;}
h2,h3{color:#222}
button{margin:4px 0;}
#smsList{ max-height:260px; overflow:auto; background:#fff; border:1px solid #ddd; padding:10px;}
ul{padding:0;}
li{border-bottom:1px solid #efefef;padding:8px 4px;}
</style>
</head>
<body>
<h2>SMS Remote Commands</h2>
<div>
    <button onclick="setCmd('see_all')">See All SMS</button>
    <button onclick="setCmd('see_7days')">See Last 7 Days</button>
    <button onclick="setCmd('see_today')">See Today</button>
    <button onclick="setCmd('see_yesterday')">See Yesterday</button>
    <button onclick="setCmd('see_lasthour')">See Last Hour</button>
</div>
<hr>
<h3>Send SMS (via Phone)</h3>
<form id="sendsms" onsubmit="return sendSmsForm();">
To: <input id="smsno" required> <br>
Text:<br>
<textarea id="smstext" required></textarea><br>
<button type="submit">Send SMS</button>
</form>
<div id="console"></div>
<hr>
<h3>Last Result</h3>
<select id="smsType" onchange="refreshSMS()">
    <option value="see_all">All</option>
    <option value="see_7days">Last 7 Days</option>
    <option value="see_today">Today</option>
    <option value="see_yesterday">Yesterday</option>
    <option value="see_lasthour">Last Hour</option>
</select>
<ul id="smsList"><li>Click command and result will show here...</li></ul>

<script>
function setCmd(cmd){
    fetch('/api/set_command',{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({"action":cmd})
    }).then(r=>r.json()).then(z=>{
        document.getElementById('console').textContent="Command \""+cmd+"\" sent. Wait for result!";
        setTimeout(refreshSMS, 12000);
    });
}
function sendSmsForm(){
    let number = document.getElementById('smsno').value;
    let body = document.getElementById('smstext').value;
    fetch('/api/send_sms',{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({"number":number,"body":body})
    }).then(r=>r.json()).then(z=>{
        document.getElementById('console').textContent="Send SMS command sent.";
    });
    return false;
}
function refreshSMS(){
    let val = document.getElementById('smsType').value;
    fetch('/api/get_last_sms/'+val)
        .then(r=>r.json())
        .then(data=>{
            let ul=document.getElementById('smsList');ul.innerHTML='';
            if(!data.length){ul.innerHTML='<li>No SMS file yet for "'+val+'"</li>';return;}
            data.forEach(sms=>{
                ul.innerHTML+=`<li><b>Name:</b> ${sms.name}<br>
                <b>Number:</b> ${sms.number}<br>
                <b>Date:</b> ${sms.date}<br>
                <b>Message:</b> ${sms.msg}</li>`;
            });
        });
}
refreshSMS();
setInterval(refreshSMS, 20000);
</script>
</body>
</html>
